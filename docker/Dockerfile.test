FROM node:20-alpine

# Create app directory
WORKDIR /test

# Install MCP Inspector for testing
RUN npm install -g @modelcontextprotocol/inspector

# Set environment variables for testing
ENV NODE_ENV=production \
    STORAGE_TYPE=file \
    PROMPTS_DIR=/test/prompts \
    LOG_LEVEL=info \
    HTTP_SERVER=true \
    PORT=3003 \
    HOST=0.0.0.0

# Create data directory
RUN mkdir -p /test/prompts

# Add healthcheck
HEALTHCHECK --interval=30s --timeout=10s --retries=3 --start-period=5s \
  CMD wget -q --spider http://localhost:3003/health || exit 1

# Test command
CMD ["sh", "-c", "echo 'Testing @sparesparrow/mcp-prompts...' && npx -y @sparesparrow/mcp-prompts"] 