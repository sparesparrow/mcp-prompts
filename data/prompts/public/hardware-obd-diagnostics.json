{
  "id": "hardware-obd-diagnostics",
  "name": "OBD-II Diagnostics Pattern",
  "description": "Structured approach for querying vehicle diagnostic data through MIA OBD-II MCP tools",
  "content": "# OBD-II Diagnostics Pattern\n\nWhen performing vehicle diagnostics through MIA OBD-II tools:\n\n## Diagnostic Sequence\n\n1. **Establish connection**: Verify OBD-II adapter connectivity\n   ```\n   # Query a basic PID to test connection\n   result = query_obd(pid=\"0x01\", service=\"CURRENT_DATA\")\n   if result.success:\n       print(\"OBD-II connection established\")\n   else:\n       print(f\"Connection failed: {result.error_code}\")\n   ```\n\n2. **Query essential parameters**: Check critical vehicle systems\n   ```\n   # Engine RPM\n   rpm = query_obd(pid=\"0x0C\", service=\"CURRENT_DATA\")\n   \n   # Vehicle Speed\n   speed = query_obd(pid=\"0x0D\", service=\"CURRENT_DATA\")\n   \n   # Coolant Temperature\n   temp = query_obd(pid=\"0x05\", service=\"CURRENT_DATA\")\n   \n   # Engine Load\n   load = query_obd(pid=\"0x04\", service=\"CURRENT_DATA\")\n   ```\n\n3. **Check trouble codes**: Retrieve diagnostic trouble codes\n   ```\n   # Query stored DTCs\n   dtc_result = query_obd(pid=\"0x01\", service=\"STORED_DIAGNOSTIC\")\n   \n   # Query pending DTCs\n   pending_result = query_obd(pid=\"0x01\", service=\"PENDING_DIAGNOSTIC\")\n   ```\n\n4. **Monitor real-time data**: Continuous data streaming\n   ```\n   # Set up monitoring loop\n   import asyncio\n   \n   async def monitor_vehicle():\n       while True:\n           data = query_obd(pid=\"0x0C\", service=\"CURRENT_DATA\")\n           if data.success:\n               print(f\"RPM: {data.decoded_value} {data.unit}\")\n           await asyncio.sleep(0.1)  # 10Hz monitoring\n   ```\n\n## Common OBD-II Queries\n\n### Engine Performance\n```python\n# Engine RPM (PID 0x0C)\nrpm = query_obd(pid=\"0x0C\", service=\"CURRENT_DATA\")\nprint(f\"Engine RPM: {rpm.decoded_value} {rpm.unit}\")\n\n# Engine Load (PID 0x04)\nload = query_obd(pid=\"0x04\", service=\"CURRENT_DATA\")\nprint(f\"Engine Load: {load.decoded_value}{load.unit}\")\n\n# Coolant Temperature (PID 0x05)\ntemp = query_obd(pid=\"0x05\", service=\"CURRENT_DATA\")\nprint(f\"Coolant Temp: {temp.decoded_value}°{temp.unit}\")\n```\n\n### Vehicle Systems\n```python\n# Vehicle Speed (PID 0x0D)\nspeed = query_obd(pid=\"0x0D\", service=\"CURRENT_DATA\")\nprint(f\"Speed: {speed.decoded_value} {speed.unit}\")\n\n# Intake Air Temperature (PID 0x0F)\nintake_temp = query_obd(pid=\"0x0F\", service=\"CURRENT_DATA\")\nprint(f\"Intake Temp: {intake_temp.decoded_value}°{intake_temp.unit}\")\n\n# Fuel Level (PID 0x2F)\nfuel = query_obd(pid=\"0x2F\", service=\"CURRENT_DATA\")\nprint(f\"Fuel Level: {fuel.decoded_value}{fuel.unit}\")\n```\n\n### Diagnostic Codes\n```python\n# Check for stored trouble codes\ndtc_stored = query_obd(pid=\"0x01\", service=\"STORED_DIAGNOSTIC\")\nif dtc_stored.data:\n    print(f\"Stored DTCs: {[hex(b) for b in dtc_stored.data]}\")\n\n# Check for pending trouble codes\ndtc_pending = query_obd(pid=\"0x01\", service=\"PENDING_DIAGNOSTIC\")\nif dtc_pending.data:\n    print(f\"Pending DTCs: {[hex(b) for b in dtc_pending.data]}\")\n```\n\n## OBD-II Service Modes\n\n| Service | Description | Common Use |\n|---------|-------------|------------|\n| CURRENT_DATA (0x01) | Real-time data | Monitoring engine parameters |\n| FREEZE_FRAME (0x02) | Freeze frame data | DTC analysis |\n| STORED_DIAGNOSTIC (0x03) | Stored DTCs | Finding existing problems |\n| CLEAR_DIAGNOSTIC (0x04) | Clear DTCs | Resetting codes after repair |\n| TEST_RESULTS (0x05-0x06) | Test results | Component testing |\n| PENDING_DIAGNOSTIC (0x07) | Pending DTCs | Detecting emerging issues |\n| CONTROL_OPERATION (0x08) | System control | Special functions |\n| VEHICLE_INFO (0x09) | Vehicle info | VIN, calibration IDs |\n| PERMANENT_DIAGNOSTIC (0x0A) | Permanent DTCs | Emission-related codes |\n\n## Error Handling\n\n```python\ntry:\n    result = query_obd(pid=\"{{obd_pid}}\", service=\"{{obd_service}}\")\n    if not result.success:\n        if \"TIMEOUT\" in result.error_code:\n            print(\"OBD adapter timeout - check connection\")\n        elif \"NO_DATA\" in result.error_code:\n            print(\"PID not supported by this vehicle\")\n        else:\n            print(f\"OBD error: {result.error_code}\")\n    else:\n        print(f\"Data: {result.decoded_value} {result.unit}\")\nexcept Exception as e:\n    print(f\"MCP tool error: {e}\")\n```\n\n## Best Practices\n\n- Always check connection before extensive queries\n- Use appropriate delays between queries (100-200ms)\n- Handle unsupported PIDs gracefully\n- Monitor for timeout errors indicating connection issues\n- Consider vehicle-specific PID support\n- Use freeze frame data for DTC analysis\n\n## Vehicle-Specific Considerations\n\n- Different vehicles support different PIDs\n- Some manufacturers use proprietary PIDs (0xF000+)\n- Heavy-duty vehicles may use J1939 instead of OBD-II\n- Hybrid vehicles have additional powertrain PIDs\n\nUse this pattern to ensure reliable vehicle diagnostics through the MIA OBD-II MCP interface.",
  "variables": [
    "obd_pid",
    "obd_service"
  ],
  "tags": ["hardware", "obd-ii", "diagnostics", "vehicle", "mcp", "mia"],
  "author": "MIA System",
  "version": "2.0.0"
}